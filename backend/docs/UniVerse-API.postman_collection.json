{
  "info": {
    "_postman_id": "universe-api-collection",
    "name": "UniVerse API - УГНТУ",
    "description": "Полная коллекция API для системы UniVerse УГНТУ\n\nБазовый URL: {{baseUrl}}\n\nРоли пользователей:\n- Абитуриент: регистрируется самостоятельно\n- Специалист: создается администратором\n- Администратор: полный доступ ко всем функциям",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "10010101"
  },
  "item": [
    {
      "name": "Проверка сервера",
      "item": [
        {
          "name": "Проверка здоровья сервера",
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{baseUrl}}/api/health",
            "description": "Проверка работоспособности сервера и подключения к БД"
          },
          "response": []
        },
        {
          "name": "Информация о сервере",
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{baseUrl}}/api",
            "description": "Получение информации о сервере и доступных эндпоинтах"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Аутентификация и Регистрация",
      "item": [
        {
          "name": "Регистрация абитуриента",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test_student@example.com\",\n  \"phone\": \"+79123456789\",\n  \"password\": \"password123\",\n  \"confirmPassword\": \"password123\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/auth/register",
            "description": "Создание нового аккаунта абитуриента\n\nОбязательные поля:\n- email: валидный email (уникальный)\n- phone: формат +7XXXXXXXXXX\n- password: минимум 6 символов\n- confirmPassword: должно совпадать с password"
          },
          "response": []
        },
        {
          "name": "Вход в систему (Абитуриент)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Автоматическое сохранение токена абитуриента",
                  "if (pm.response.code === 200) {",
                  "    const responseData = pm.response.json();",
                  "    if (responseData.data && responseData.data.token) {",
                  "        pm.collectionVariables.set('authTokenAbiturient', responseData.data.token);",
                  "        pm.collectionVariables.set('abiturientId', responseData.data.user.id);",
                  "        console.log('Токен абитуриента сохранен');",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"abiturient1@example.com\",\n  \"password\": \"password123\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/auth/login",
            "description": "Аутентификация абитуриента\n\nТестовые данные из init-test-data:\n- Email: abiturient1@example.com\n- Password: password123"
          },
          "response": []
        },
        {
          "name": "Вход в систему (Администратор)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Автоматическое сохранение токена администратора",
                  "if (pm.response.code === 200) {",
                  "    const responseData = pm.response.json();",
                  "    if (responseData.data && responseData.data.token) {",
                  "        pm.collectionVariables.set('authTokenAdmin', responseData.data.token);",
                  "        pm.collectionVariables.set('adminId', responseData.data.user.id);",
                  "        console.log('Токен администратора сохранен');",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@ugntu.ru\",\n  \"password\": \"admin123\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/auth/login",
            "description": "Аутентификация администратора\n\nТестовые данные:\n- Email: admin@ugntu.ru\n- Password: admin123"
          },
          "response": []
        },
        {
          "name": "Вход в систему (Специалист)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Автоматическое сохранение токена специалиста",
                  "if (pm.response.code === 200) {",
                  "    const responseData = pm.response.json();",
                  "    if (responseData.data && responseData.data.token) {",
                  "        pm.collectionVariables.set('authTokenSpecialist', responseData.data.token);",
                  "        console.log('Токен специалиста сохранен');",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"specialist@ugntu.ru\",\n  \"password\": \"specialist123\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/auth/login",
            "description": "Аутентификация специалиста\n\nТестовые данные:\n- Email: specialist@ugntu.ru\n- Password: specialist123"
          },
          "response": []
        },
        {
          "name": "Проверка токена",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authTokenAdmin}}"
              }
            ],
            "url": "{{baseUrl}}/api/auth/verify",
            "description": "Верификация JWT токена"
          },
          "response": []
        },
        {
          "name": "Выход из системы",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authTokenAdmin}}"
              }
            ],
            "url": "{{baseUrl}}/api/auth/logout",
            "description": "Выход из системы (удаление токена на клиенте)"
          },
          "response": []
        },
        {
          "name": "Обновление токена",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authTokenAdmin}}"
              }
            ],
            "url": "{{baseUrl}}/api/auth/refresh",
            "description": "Обновление JWT токена"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Управление пользователями (Админ)",
      "item": [
        {
          "name": "Получить список пользователей",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authTokenAdmin}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users?page=1&limit=10",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "10"
                }
              ]
            },
            "description": "Получение списка пользователей с пагинацией\n\nДоступно только администраторам\n\nQuery параметры:\n- page: номер страницы (по умолчанию 1)\n- limit: количество записей на странице (по умолчанию 10)\n- role: фильтр по роли (abiturient|specialist|admin)\n- is_active: фильтр по активности (true|false)"
          },
          "response": []
        },
        {
          "name": "Получить текущего пользователя",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authTokenAdmin}}"
              }
            ],
            "url": "{{baseUrl}}/api/users/me",
            "description": "Получение информации о текущем авторизованном пользователе"
          },
          "response": []
        },
        {
          "name": "Получить пользователя по ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authTokenAdmin}}"
              }
            ],
            "url": "{{baseUrl}}/api/users/{{abiturientId}}",
            "description": "Получение информации о пользователе по его ID\n\nДоступ: администратор или владелец аккаунта"
          },
          "response": []
        },
        {
          "name": "Создать пользователя (Специалист)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{authTokenAdmin}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"new.specialist@ugntu.ru\",\n  \"phone\": \"+79876543210\",\n  \"password\": \"newpass123\",\n  \"role\": \"specialist\",\n  \"is_active\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/users",
            "description": "Создание нового пользователя (специалиста)\n\nДоступно только администраторам\n\nОбязательные поля:\n- email: валидный email (уникальный)\n- phone: формат +7XXXXXXXXXX\n- password: минимум 6 символов\n- role: abiturient|specialist|admin"
          },
          "response": []
        },
        {
          "name": "Обновить текущего пользователя",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{authTokenAdmin}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"phone\": \"+79991234567\",\n  \"email\": \"admin.new@ugntu.ru\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/users/me",
            "description": "Обновление данных текущего пользователя"
          },
          "response": []
        },
        {
          "name": "Обновить пользователя по ID",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{authTokenAdmin}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"role\": \"specialist\",\n  \"is_active\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/users/{{abiturientId}}",
            "description": "Обновление пользователя по ID\n\nДоступно только администраторам"
          },
          "response": []
        },
        {
          "name": "Удалить пользователя",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authTokenAdmin}}"
              }
            ],
            "url": "{{baseUrl}}/api/users/{{abiturientId}}",
            "description": "Деактивация пользователя по ID\n\nДоступно только администраторам\n\nПримечание: пользователь не удаляется физически, а деактивируется (is_active = false)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Профиль абитуриента",
      "item": [
        {
          "name": "Получить профиль абитуриента",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authTokenAbiturient}}"
              }
            ],
            "url": "{{baseUrl}}/api/abiturient/profile",
            "description": "Получение полного профиля абитуриента\n\nДоступ: только абитуриенты"
          },
          "response": []
        },
        {
          "name": "Обновить персональные данные",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{authTokenAbiturient}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"last_name\": \"Иванов\",\n  \"first_name\": \"Иван\",\n  \"middle_name\": \"Иванович\",\n  \"birth_date\": \"2005-06-15\",\n  \"gender\": \"male\",\n  \"consent_personal_data\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/abiturient/profile/personal",
            "description": "Обновление персональных данных абитуриента\n\nОбязательные поля:\n- last_name: фамилия (1-100 символов)\n- first_name: имя (1-100 символов)\n- birth_date: дата рождения (формат YYYY-MM-DD, возраст ≥ 14 лет)\n- gender: пол (male|female)\n- consent_personal_data: согласие на обработку (только true)\n\nОпциональное поле:\n- middle_name: отчество (0-100 символов)"
          },
          "response": []
        },
        {
          "name": "Получить контактную информацию",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authTokenAbiturient}}"
              }
            ],
            "url": "{{baseUrl}}/api/abiturient/contact",
            "description": "Получение контактной информации абитуриента\n\nВключает:\n- email\n- телефон\n- мессенджеры"
          },
          "response": []
        },
        {
          "name": "Обновить контактную информацию",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{authTokenAbiturient}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"phone\": \"+79123456789\",\n  \"email\": \"new.email@example.com\",\n  \"messengers\": {\n    \"telegram\": \"@ivanov\",\n    \"vkontakte\": \"id123456789\",\n    \"whatsapp\": \"+79123456789\",\n    \"other\": \"Skype: ivan.ivanov\"\n  }\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/abiturient/contact",
            "description": "Обновление контактной информации\n\nОпциональные поля (хотя бы одно должно быть):\n- phone: телефон в формате +7XXXXXXXXXX\n- email: валидный email\n- messengers: объект с мессенджерами\n  - telegram: @username (5-32 символа)\n  - vkontakte: id123456789 или короткое имя\n  - whatsapp: +7XXXXXXXXXX\n  - other: произвольный текст (до 100 символов)"
          },
          "response": []
        },
        {
          "name": "Обновить только телефон",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{authTokenAbiturient}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"phone\": \"+79991234567\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/abiturient/contact",
            "description": "Обновление только номера телефона"
          },
          "response": []
        },
        {
          "name": "Обновить только мессенджеры",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{authTokenAbiturient}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"messengers\": {\n    \"telegram\": \"@newtelegram\",\n    \"vkontakte\": \"new_profile\"\n  }\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/abiturient/contact",
            "description": "Обновление только информации о мессенджерах"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Тестирование ошибок",
      "item": [
        {
          "name": "Регистрация с невалидным email",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"invalid-email\",\n  \"phone\": \"+79123456789\",\n  \"password\": \"password123\",\n  \"confirmPassword\": \"password123\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/auth/register",
            "description": "Тест валидации: неверный формат email"
          },
          "response": []
        },
        {
          "name": "Регистрация с неверным телефоном",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@example.com\",\n  \"phone\": \"89123456789\",\n  \"password\": \"password123\",\n  \"confirmPassword\": \"password123\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/auth/register",
            "description": "Тест валидации: неверный формат телефона (должен быть +7)"
          },
          "response": []
        },
        {
          "name": "Регистрация с коротким паролем",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@example.com\",\n  \"phone\": \"+79123456789\",\n  \"password\": \"123\",\n  \"confirmPassword\": \"123\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/auth/register",
            "description": "Тест валидации: пароль менее 6 символов"
          },
          "response": []
        },
        {
          "name": "Обновление профиля без согласия",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{authTokenAbiturient}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"last_name\": \"Иванов\",\n  \"first_name\": \"Иван\",\n  \"birth_date\": \"2005-06-15\",\n  \"gender\": \"male\",\n  \"consent_personal_data\": false\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/abiturient/profile/personal",
            "description": "Тест валидации: попытка обновить данные без согласия"
          },
          "response": []
        },
        {
          "name": "Доступ без токена",
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{baseUrl}}/api/users/me",
            "description": "Тест безопасности: доступ к защищенному эндпоинту без токена"
          },
          "response": []
        },
        {
          "name": "Доступ с неверной ролью",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authTokenAbiturient}}"
              }
            ],
            "url": "{{baseUrl}}/api/users",
            "description": "Тест безопасности: доступ абитуриента к админскому эндпоинту"
          },
          "response": []
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "console.log(`Запуск запроса к UniVerse API: ${pm.request.method} ${pm.request.url}`);",
          "",
          "// Очистка переменных при запуске тестов",
          "if (pm.info.requestName.includes('Вход в систему')) {",
          "    console.log('Подготовка к тесту входа в систему');",
          "}"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Базовые проверки для всех ответов",
          "pm.test('Формат ответа корректный', function () {",
          "    const response = pm.response.json();",
          "    pm.expect(response).to.have.property('success');",
          "    pm.expect(response).to.have.property('message');",
          "});",
          "",
          "// Проверка успешных ответов",
          "if (pm.response.code >= 200 && pm.response.code < 300) {",
          "    pm.test('Успешный ответ содержит success: true', function () {",
          "        const response = pm.response.json();",
          "        pm.expect(response.success).to.be.true;",
          "    });",
          "}",
          "",
          "// Проверка ошибок",
          "if (pm.response.code >= 400) {",
          "    pm.test('Ошибочный ответ содержит success: false', function () {",
          "        const response = pm.response.json();",
          "        pm.expect(response.success).to.be.false;",
          "        pm.expect(response).to.have.property('error');",
          "    });",
          "}",
          "",
          "// Автоматическое сохранение токенов из ответов",
          "if (pm.response.code === 200 && pm.response.json().data && pm.response.json().data.token) {",
          "    const token = pm.response.json().data.token;",
          "    const userRole = pm.response.json().data.user?.role;",
          "    ",
          "    // Определяем, какой токен сохранять",
          "    if (userRole === 'admin') {",
          "        pm.collectionVariables.set('authTokenAdmin', token);",
          "        console.log('Токен администратора сохранен в переменные');",
          "    } else if (userRole === 'abiturient') {",
          "        pm.collectionVariables.set('authTokenAbiturient', token);",
          "        console.log('Токен абитуриента сохранен в переменные');",
          "    } else if (userRole === 'specialist') {",
          "        pm.collectionVariables.set('authTokenSpecialist', token);",
          "        console.log('Токен специалиста сохранен в переменные');",
          "    }",
          "}",
          "",
          "// Сохранение ID пользователей",
          "if (pm.response.code === 200 && pm.response.json().data && pm.response.json().data.user) {",
          "    const userId = pm.response.json().data.user.id;",
          "    const userRole = pm.response.json().data.user.role;",
          "    ",
          "    if (userRole === 'admin') {",
          "        pm.collectionVariables.set('adminId', userId);",
          "    } else if (userRole === 'abiturient') {",
          "        pm.collectionVariables.set('abiturientId', userId);",
          "    }",
          "}"
        ]
      }
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3001",
      "type": "string",
      "description": "Базовый URL API сервера"
    },
    {
      "key": "authTokenAdmin",
      "value": "",
      "type": "string",
      "description": "JWT токен администратора"
    },
    {
      "key": "authTokenAbiturient",
      "value": "",
      "type": "string",
      "description": "JWT токен абитуриента"
    },
    {
      "key": "authTokenSpecialist",
      "value": "",
      "type": "string",
      "description": "JWT токен специалиста"
    },
    {
      "key": "adminId",
      "value": "",
      "type": "string",
      "description": "ID пользователя-администратора"
    },
    {
      "key": "abiturientId",
      "value": "",
      "type": "string",
      "description": "ID пользователя-абитуриента"
    }
  ],
  "auth": null
}
